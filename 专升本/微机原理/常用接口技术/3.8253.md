# 8253

* 定时器：由计数电路构成，通过记录高精度晶振脉冲信号的个数，数据准确的时间间隔

* 计数器：计数电路如果记录外设提供的具有一定随机性的脉冲信号时，它主要反映脉冲个数

* 原理：均采用减1计数的倒计数原理，每过一个CLK周期计算器减1

* 8253的内部结构和引脚

  * 原理

    * 2种计数制：按二进制或BCD，码计数

    * 3个独立的16位计数器0-65535/0-9999

    * 4个端口地址

    * 6种工作方式

    * ![image-20250404183619049](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404183619049.png)

    * ![image-20250404183710256](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404183710256.png)

    * CLK：时钟输入信号Fclk Tclk

    * GATE：门控输入信号

    * 控制计数器是否计数

    * 两种：电平控制和上升沿控制

    * OUT：计数器输出信号

      * 当计数值减为0，OUT引脚上产生一个输出信号
      * Fout、Tout

    * 数据线：8位

    * 地址线：2位

    * CS*片选

    * RD*读信号

    * WR*写信号

    * ![image-20250404183820542](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404183820542.png)

    * 8253的工作方式

      * 由6种工作方式，由方式控制字确定
      * 工作方式类型
        * 方式0：计数结束中断
        * 方式1：可编程（负）单稳脉冲
        * 方式2：频率发生器（分频器）
        * 方式3：方波发生器
        * 方式4：软件触发选通信号
        * 方式5：硬件触发选通信号

    * 工作方式特点

      * 输出OUT波形只有方式0写入控制字后位低电平，其他为高电平

      * 只有方式2和3连续计数，其他必须重新启动，写入初值0和4软件启动，1和5硬件启动

      * 方式0、2、3、4计数启动考试减1计数

      * 方式1、5需要gate触发启动

      * 方式2、4、5输出波形均为一个CLK周期的负脉冲宽度的波形

      * 只有方式2和3为自动装入初值循环计数

      * 方式1和5由外部gate上升沿触发启动计数器

      * 方式0~4为计数值启动后，开始计数

      * ![image-20250404183911010](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404183911010.png)

      * 方式0：计数结束（产生）中断方式；软件启动，不重复计数，计数结束OUT输出高电平，可作为中断请求信号

      * 特点

        * 只计数一个周期，重新写入计数初值后，开始新的计数周期
        * 在计数过程中，GATE变为低电平，停止计数
        * 在脉冲信号下降沿，计数器减1
        * 计数过程中，可修改计数值

      * 方式1：GATE信号的单稳负脉冲（可编程单稳触发器）

        * 负脉冲：是一个由高电平跳变到低电平，然后再有低电平跳变到高电平的信号
        * 硬件启动，不自动重复的工作方式
        * 特点
          * 写入控制字后，OUT输出高电平
          * 写入计数器初值后，计数器不开始计数，当GATE端由低到高跳变后，在下一个脉冲的下降沿开始计数，OUT端由高变低，计数结束后，OUT输出高电平（GATE由低到高才出发计数）

      * 方式2：频率发生器（分频器）

        * 可以软件启动，也可以硬件启动，计数器自动重复计数
        * 特点
          * 在写入控制字和技数值期间GATE一直为高电平，则在下一个clk开始计数
          * 若写入初值时，GATE位低电平，则要等到GATE由低到高时才启动
          * 一但启动，可以重复工作

      * 方式3：方波发生器

        * 可以软件启动，也可以硬件启动，计数器自动重复工作，写入控制字后，OUT为高电平，如果GATE位高电平，写入初值后，开始减1
        * 当计数器减到N/2时（高电平与低电平一样多），OUT变为低电平，直到减为0，接着自动重新装入初值，OUT变为高电平，计数器自动重复工作

      * 方式4：软件触发选通信号发生器

        * 软件启动，不自动重复计数
        * 写入控制字后，OUT为高电平，计数器装入初值后即自动计数，计数结束后，OUT输出一个Tclk宽度负脉冲

      * 方式5硬件触发选通信号发生器

        * 硬件启动，不自动重复计数
        * GATE上升沿触发计数器，计数结束后，OUT输出一个Tclk宽度负脉冲
        * GATE再次出现上升沿，将重新计数

      * 由软件触发计数（送新的计数值）——方式0、方式4

      * 由硬件触发计数（由GATE触发）——方式1、方式5

      * 分频计数器输出（产生序列脉冲）——方式2、方式3

      * 8253的编程

        * 确定8253的4个端口地址
        * 确定CPU写入 8253的初值和计数制
        * 确定CPU 写入8253的方式控制字
        * 编写8253的初始化程序段

      * 方式控制字

      * ![image-20250404184141659](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404184141659.png)

      * ![image-20250404184217142](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404184217142.png)

      * ![image-20250404184242506](E:\study\lianxi\MyLearningDocuments\专升本\images\image-20250404184242506.png)

        

