# 8088/86引脚

* ![image-20250326101123704](E:\study\lianxi\MyLearningDocuments\images\image-20250326101123704.png)
* ![image-20250331141332713](E:\study\lianxi\MyLearningDocuments\images\image-20250331141332713.png)
  * 带星*或字母上有横线的都代表低电平运行
* 引脚的功能
  * CPU引脚是系统总线的基本信号可以分成三类型号
  * 八位数据线
    * 8088：D0~D7
    * 8086：D0~D15
  * 二十位地址线：A0~A19
  * 控制线
    * ALE、IO/M*、（8088：M/IO*）、WR*、RD*、READY
    * INTR、INTA*、NMI、HOLD、HLDA
    * RESET、CLK、Vcc、GND
  * 信号的流向
  * 有效电平
    * 引脚信号的传输有以下几种类型
      * 输出：信号从CPU向外传送
      * 输入：信号从外部送入CPU
      * 双向：信号有时从外部送入CPU，有时从CPU向外部传送（数据线是双向的）
      * 三态：除了高电平、低电平两种状态之外，CPU内部还可以通过一个大的电阻，阻断内外信号的传送，CPU部的状态与外部相互隔离，称为悬浮态。高电平（1）、低电平（0）
        * 挂A的都是地址总线 地址线是输出的
        * 挂D的都是数据总线，数据线是双向的
        * 代杠或*的表示低电平有效
* 分时复用
* 三态能力
* 88/86对比
  * ![image-20250331141550665](E:\study\lianxi\MyLearningDocuments\images\image-20250331141550665.png)
  * 数据总线的位数差别：88八位，86十六位
  * 指令队列容量的差别：88四字节，86六字节
* 引脚的差别
  * AD0~AD15的定义不同
  * 34号引脚的定义不同88是SSO，86是BHE
  * 28号引脚不同，88是IO/M，86是M/IO
  * ![image-20250401141327960](E:\study\lianxi\MyLearningDocuments\images\image-20250401141327960.png)
* 88最小工作模式
  * CPU工作模式的选择是由硬件决定的
  * ![image-20250331141702745](E:\study\lianxi\MyLearningDocuments\images\image-20250331141702745.png)
  * 8284：时钟信号发生器
  * 8282：地址锁存器 20位地址需要三片
  * 8286：双向总线收发器（82最小工作模式需要2片）为88、86增加驱动能力作用的功率放大器 16位数据需要两片
  * 8288 总线控制器
  * 8087 算数协处理器
  * 8089输入/输出协处理器
  * 8289总线仲裁器
  * 工作模式：MN/MX*=1
  * 系统中只有一个88/86微处理器
  * 最小模式是单处理系统
  * 系统中所需要的控制信号全部由88/86CPU本身直接提供。
  * 最小模式下的HDLD和HLDA信号支持DMA工作
  * 在86最小模式下，分时使用AD0~AD15所以必须外接地址锁存储器，当总线上为地址信息时，通过ALE信号将地址送入地址锁存储器
  * 86最小工作模式下，决定CPU最终接受或发送数据的引脚是DT/R
  * 引脚MN/MX接Vcc（高电平有效）
  * 控制引脚的含义
    * **ALE**：地址锁存允许信号，用于分离复用总线上的地址信息并锁存到外部地址锁存器，高电平时总线上为地址信息。
    * **IO/M（8086）、M/IO**（8088）：区分 CPU 对存储器或 I/O 设备的操作，8086 中低电平为访问存储器，高电平为访问 I/O 设备；8088 反之。
    * **WR\*与 RD\***：分别控制对存储器或 I/O 设备的写与读操作，低电平时执行相应操作。
    * **READY**：外部设备准备好数据传输的信号，高电平表示准备好，低电平时 CPU 插入等待周期。
    * **INTR**：可屏蔽中断请求信号，外部设备置高电平发起请求，可由软件设置屏蔽。
    * **DEN***：数据允许，输出、三态、低电平有效
    * **DT/R***：数据发送/接收，输出、三态
    * **INTR**可屏蔽中断请求 IF = 1，允许中断，IF=0不允许中断
    * **INTA***：中断响应信号，CPU 响应 INTR 中断时输出低电平脉冲通知外部中断源。
    * **NMI**：不可屏蔽中断请求信号，上升沿触发，优先级高且不能被软件屏蔽，用于紧急情况处理。
      * INTA与NMI的比较
      * ![image-20250401152636173](E:\study\lianxi\MyLearningDocuments\images\image-20250401152636173.png)
    * **HOLD 与 HLDA**：HOLD 是总线保持请求信号，外部设备请求总线控制权时置高电平；HLDA 是总线保持响应信号，CPU 同意让出总线时置高电平。
    * **RESET**：复位信号，高电平持续一定时间使 CPU 复位，恢复内部寄存器等初始状态并从特定地址开始执行程序。
    * **CLK**：时钟引脚，接收外部时钟信号决定 CPU 工作频率与操作速度。
    * **Vcc 与 GND**：Vcc 是 +5V 电源引脚，GND 是接地引脚，保障 CPU 及电路元件正常工作。
  * 地址总线AB
    * 单向，三态总线，用于传送地址信息，其位数决定可直接寻址的范围；
  * 数据总线DB
    * 双向，三态总线，用于传送数据信息，其位数有8、16、32、64
* 88/86CPU操作时序
  * 时钟周期 T（s）=1/f
  * 1Hz=1s
  * 总线周期（机器周期）
    * 基本的总线周期由四个时钟周期（T1、T2、T3、T4）
    * 是CPU进行一次读写的时间，也是若用一次总线进行输入/输出的时间
    * 当外设不能再T1~T4实现数据传输时，要在T3T4之间插入Tw
  * 指令周期：完成一条指令的时间
    * 不同指令指令周期长度不同，所需总线周期个数也不同
  * 区分
    * 时钟频率又称主频f，他是指CPU内部晶振的频率，常用单位为MHz，他反映了CPU的基本工作节拍
    * 时钟周期t：t=1/f 主频的倒数
    * 总线周期：包含四个周期
    * 机器周期：mt；一个机器周期包含若干个（m个）时钟周期
    * 指令周期：mtn；执行一条指令所需要的时间，一般包含若干个（n个）机器周期MIPS=每秒执行百万条指令数=1/（指令周期*10的六次方）
  * 等待周期 TW：T3没干完的活进行加时
  * 空闲周期Ti ：总线周期之间插入即空闲时间
  * 系统复位与启动的特点
    * reset
      * 复位请求，输入高电平有效，该信号有效，将使cpu初始化
      * 所有三态线处于高阻（浮空）
      * 段寄存器cs和指令指针ip分别被初始化为FFFFH和0000H，其他寄存器清0，指令队列清零
      * 8086时钟信号CLK和刚上电时的复位信号RESET应该由8284时钟发生器来产生
      * 由低到高（时序图）才是复位至少需要4个Tclk高电平
      * 在复位后由于标志寄存器的各位均被清零，是IF=0，出于关中断状态8088/8086cpu不能响应可屏蔽的中断请求
      * 因而在系统程序的初始化时，用指令STI使标志寄存器中的IF=1（开中断），以使CPU能够响应可屏蔽中断请求（允许高一级中断产生）
* 中断
  * 中断概念
    * 当cpu执行主程序时，由于内/外事件使cpu暂时终止当前程序的运行，转而区执行中断服务子程序，当子程执行完后，返回主程序的进程
    * 中断源：引起中断的原因；分为外部中断和内部中断
    * 引起中断的时间或原因，包括外设故障和cpu执行时出现的异常
    * ![image-20250331142153950](E:\study\lianxi\MyLearningDocuments\images\image-20250331142153950.png)
  * 中断类型
    * 外部中断（外设产生的中断）
      * 外部中断时由于86/88外部提出中断请求引起的程序中断
      * 利用外部中断，微机系统可以实时响应，能够及时处理外部意外或经济事件
      * 外部中断时外设随机产生的，是真正的中断
    * 非屏蔽中断的特点
      * 通过NMI向cpu提出的中断请求
      * cpu无法禁止（非屏蔽）
      * 在当前指令执行结束后给予响应
      * 中断向量号为2
      * 主要用于处理系统的意外或故障
    * 可屏蔽中断的特点
      * 外设通过INTR（可屏蔽中断请求信号）向cpu提出中断请求在允许中断、当前指令执行结束后给予响应输出INTA*
      * IF=1，开中断，允许响应；IF=0，禁止中断
      * 中断向量号由8259（接口芯片）提供
      * 主要用于主机与外设交换数据
      * 中断标志IF的状态
        * IF=0：可屏蔽中断不会被响应
        * 关中断、禁止中断、中断屏蔽
        * 系统复位，是IF=0
        * 中断被响应，使IF=0
        * 执行指令CLI，是IF=0
        * IF=1；可平布中断会被响应
        * 开中断，允许中断、中断开放
        * 执行指令STI，使IF=1
        * 执行指令IRET恢复原IF状态
    * 可屏蔽中断的响应条件
      * 现执行指令结束
        * 88/86cpu在当前指令的最后一个机器周期的最后一个T状态采样INTR线，查看是否有
      * cpu开放中断
        * cpu标志寄存器的IF为1，中断开放
      * 没有更高优先级的请求
        * 没有更高优先级的请求、没有复位RESET信号、DMA、内部中断和不可屏蔽中断请求
      * cpu没有正在为高级的可屏蔽中断服务
    * 内部中断（软件中断、程序指令中断）
      * 内部中断是有8088内部执行程序出现异常引起的程序中断
    * 中断类型码（中断向量号）
      * 为了却别不同类型的中断，系统为每个中断设置的编号
      * 共0~255（00H~FFH）用n表示
      * INTn=21H：DOS功能调用中断
      * INTn的中断号是由指令直接给出
      * 每个中断类型码与一个中断向量相对应
      * 除法错误（0型中断）
        * 在执行除法指令时，若除数为0或商超过了寄存器所能表达的范围，则产生一个向量号为0的内部中断，称为出发错误中断
      * 单步中断（1型中断）
        * 若单步中断TF为1，则在每条指令结束后产生一个向量号为1的内部中断，称为单步中断
      * 断点中断（3型）
        * 向量号为3的指令中断比较特别，常用语程序调试，被称为断点中断
      * 溢出中断（4型）
        * 在执行溢出中断指令INTO时，若溢出标志OF=1，则产生一个向量号为4的内部中断，被称为溢出中断
      * 指令中断（n型中断）
        * 在执行中断调用指令IN时产生的一个向量号为n（0~255）的内部中断，称为指令中断
      * 中断向量：中断服务程序入口地址
        * 逻辑地址：CS：IP
        * 物理地址CS*16+IP
    * 中断向量表：
      * 用以存放中断服务程序入口地址的内部空间
      * 存放中断向量额表格
      * 在内存的前1KB中地址范围：（000H~3FFH）1KB的空间
      * 88/86系统内存中共存放256个中断向量，每个中断向量（低字节单元时偏移地址IP，高字节单元是段地址CS）占4字节，共占用1KB
      * 向量表地址：中断向量在中断向量表中的位置
      * 在86系统中n*4→向量表的入口，从此处读出4字节内容即为中断向量
    * 中断嵌套
      * 优点：提供中断响应的实时性，保证系统能够及时响应优先级较高的中断请求
      * 实现中断嵌套的条件
        * 中断请求的优先级高于正在执行的中断处理程序的优先级
        * 如果是外中断，cpu的PSW的IF=1，开中断
        * 中断请求未被8259屏蔽
        * 没有不可屏蔽中断请求和总线请求
    * 中断过程
      * 中断请求：INTR
      * 中断判优：8259判优 高 → cpu
      * 中断响应：cpu响应优先级高请求中断处理
      * 中断返回：lret
    * 中断相应条件
      * CPU必须执行完当前的指令
      * CPU处于开中断
      * 不能有更高级（优先级）的中断请求
    * INTA*
      * 包含两个总线周期INTA*
      * 第一个有效表示：CPU响应中断请求；第二个有效表示：外设想CPU提供中断类型码，CPU根据中类型码确定中断向量，找到了程序入口地址
      * 过程
        * 取中断类型码n
        * 保护现场：标志寄存器入栈。TF、IF清零
        * 保护断点：CS：IP入栈
        * 确定中断向量
          * n*4→中断向量表地址（首地址往下数3个，一共四个）→取出中断向量
      * 返回lret
        * 恢复断点：从堆栈中取出断点
        * 执行主程序离开时将要执行的指令地址
        * 中断服务子程序的一般构成
      * ![image-20250402142844989](E:\study\lianxi\MyLearningDocuments\images\image-20250402142844989.png)
    * 断点cs：IP
      * 执行子程序时断点入栈保护
      * 子程序执行完成返回主程序时，回复断点即出栈